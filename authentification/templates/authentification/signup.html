{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
    #hero-header{
        display: none;
    }
    
    body{
    
    margin-top : 110px;
    
  }
    
   .deconnexion{
        display: none;
    }
</style>
   

<div class="login-card" role="main" aria-labelledby="site-title">
    <h1 id="site-title">Inscription</h1>
    <p class="lead">Cr√©e ton compte pour partager tes photos</p>

    {% if form.errors %}
    <div class="errors_messages">
        <strong>Erreur</strong>
        <ul>
            {% for field, errors in form.errors.items %}
                {% for error in errors %}
                    <li>{{ error }}</li>
                {% endfor %}
            {% endfor %}
        </ul>
    </div>
    {% endif %}

    <form method="post" enctype="multipart/form-data" novalidate id="signupForm">
        {% csrf_token %}

        <div class="form-group">
            <input type="text" name="username" id="id_username" placeholder=" " required>
            <label for="id_username">Nom d‚Äôutilisateur</label>
        </div>

        <div class="form-group">
            <input type="email" name="email" id="id_email" placeholder=" " required>
            <label for="id_email">Email</label>
        </div>

        <div class="form-group">
            <div class="custom-select" id="roleSelect">
                <input type="text" id="roleInput" placeholder=" " readonly required>
                <label for="roleInput">R√¥le</label>
                <div class="options">
                    {% for value, label in form.fields.role.choices %}
                    <div class="option" data-value="{{ value }}">{{ label }}</div>
                    {% endfor %}
                </div>
            </div>
            {{ form.role }} {# champ cach√© Django #}
        </div>

        <script>
        const roleInput = document.getElementById('roleInput');
        const roleSelect = document.getElementById('roleSelect');
        const options = roleSelect.querySelectorAll('.option');
        const hiddenRole = document.getElementById('id_role');

        roleInput.addEventListener('click', () => {
            const dropdown = roleSelect.querySelector('.options');
            dropdown.style.display = dropdown.style.display === 'block' ? 'none' : 'block';
        });

        options.forEach(option => {
            option.addEventListener('click', () => {
                roleInput.value = option.textContent;
                roleInput.classList.add('filled'); 
                hiddenRole.value = option.dataset.value;
                roleSelect.querySelector('.options').style.display = 'none';
            });
        });

        document.addEventListener('click', (e) => {
            if (!roleSelect.contains(e.target)) {
                roleSelect.querySelector('.options').style.display = 'none';
            }
        });
        </script>

        <div class="password_conditions" id="passwordConditions">
            <p>Votre mot de passe doit avoir :</p>
            <ul>
                {% for cond in password_conditions %}
                <li id="cond-{{ cond.key }}">{{ cond.label }}</li>
                {% endfor %}
            </ul>
        </div>

        <div class="form-group">
            <input type="password" name="password1" id="id_password1" placeholder=" " required>
            <label for="id_password1">Mot de passe</label>
        </div>

        <div class="form-group">
            <input type="password" name="password2" id="id_password2" placeholder=" " required>
            <label for="id_password2">Confirmer le mot de passe</label>
        </div>

        <div class="form-checkbox">
            <input type="checkbox" id="showPassword" onclick="togglePassword()">
            <label for="showPassword">Afficher le mot de passe</label>
        </div>

        <button type="submit" id="signupBtn" disabled>Cr√©er un compte</button>
    </form>

    <p class="footnote">
        D√©j√† un compte ?  
        <a href="{% url 'login' %}">Se connecter</a>
    </p>

</div>  

<div class="social-separator">
    <span> Ou continuer avec </span>
</div>

<div style="text-align:center; margin-bottom: 12px;">
    <a href="#" class="btn-google">
        <img src="{% static 'icons/icons8-google.svg' %}" alt="Google">
        Google
    </a>
</div>

<p class="conditions-text">
    En te connectant, tu acceptes nos 
    <a href="#">Conditions d‚Äôutilisation</a> et 
    <a href="#">Politique de confidentialit√©</a>.
</p>

<script>
document.addEventListener("DOMContentLoaded", () => {
    const passwordInput = document.getElementById("id_password1");
    const signupBtn = document.getElementById("signupBtn");
    const signupForm = document.getElementById("signupForm");
    const conditions = {
        length: /.{6,}/,
        uppercase: /[A-Z]/,
        lowercase: /[a-z]/,
        number: /[0-9]/
    };
    const errorsBox = document.getElementById("passwordConditions");

    function checkConditions() {
        let allValid = true;
        const value = passwordInput.value;

        for (let key in conditions) {
            const conditionEl = document.getElementById("cond-" + key);
            if (!conditionEl) continue;

            if (conditions[key].test(value)) {
                conditionEl.style.color = "#16a34a"; // vert
                conditionEl.style.fontWeight = "500";
            } else {
                conditionEl.style.color = "#c2c2c2"; // gris clair
                conditionEl.style.fontWeight = "normal";
                allValid = false;
            }
        }

        // Bordure globale
        errorsBox.style.border = allValid ? "1px solid #16a34a" : "1px solid rgba(255, 255, 255, 0.4)";
        signupBtn.disabled = !allValid;
    }

    passwordInput.addEventListener("input", checkConditions);
    checkConditions();

    // üîπ Bloquer double clic / double soumission
    signupForm.addEventListener("submit", () => {
        signupBtn.disabled = true;
    });
});

// üîπ Toggle mot de passe
function togglePassword() {
    const pwd1 = document.getElementById("id_password1");
    const pwd2 = document.getElementById("id_password2");
    [pwd1, pwd2].forEach(p => {
        p.type = p.type === "password" ? "text" : "password";
    });
}
</script>

{% endblock content %}