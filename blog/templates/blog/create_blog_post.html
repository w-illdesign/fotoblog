{% extends 'base.html' %}
{% block content %}

<div class="blog-card">
    <h2>Écrire un billet</h2>

  <form method="post" enctype="multipart/form-data" class="blog-photo-form">
    {% csrf_token %}

    <!-- Photo -->
    <div class="form-group-container">
        <div class="form-group">
            <img id="image-preview" alt="Aperçu de l'image">
            <label for="id_image">{{ photo_form.image.label }}</label>
            <input type="file" name="{{ photo_form.image.name }}" id="id_image">
            {% for error in photo_form.image.errors %}
                <div class="form-error">{{ error }}</div>
            {% endfor %}
        </div>
        <div class="form-group">
            <label for="id_caption">{{ photo_form.caption.label }}</label>
            <input type="text" name="{{ photo_form.caption.name }}" id="id_caption" value="{{ photo_form.caption.value|default_if_none:'' }}">
            {% for error in photo_form.caption.errors %}
                <div class="form-error">{{ error }}</div>
            {% endfor %}
        </div>
    </div>

    <!-- Blog -->
    <div class="form-group-container">
        <div class="form-group">
            <label for="id_title">{{ blog_form.title.label }}</label>
            <input type="text" name="{{ blog_form.title.name }}" id="id_title" value="{{ blog_form.title.value|default_if_none:'' }}">
            {% for error in blog_form.title.errors %}
                <div class="form-error">{{ error }}</div>
            {% endfor %}
        </div>
        <div class="form-group" style="flex:1 1 100%;">
            <label for="id_content">{{ blog_form.content.label }}</label>
            <textarea name="{{ blog_form.content.name }}" id="id_content">{{ blog_form.content.value|default_if_none:'' }}</textarea>
            {% for error in blog_form.content.errors %}
                <div class="form-error">{{ error }}</div>
            {% endfor %}
        </div>
        <!-- Champ Tags -->
        <div class="form-group" style="flex:1 1 100%;">
            <label for="id_tags">Tags (séparés par des virgules)</label>
            <input type="text" name="tags" id="id_tags" value="">
        </div>
    </div>

    {% for error in blog_form.non_field_errors %}
        <div class="form-error">{{ error }}</div>
    {% endfor %}

    <button type="submit" id="edit-btn">Publier</button>
</form>
</div>

<script>
const imageInput = document.querySelector('input[type="file"]');
const preview = document.getElementById('image-preview');

if (imageInput && preview) {
    imageInput.addEventListener('change', function() {
        const file = this.files[0];
        if(file){
            const reader = new FileReader();
            reader.onload = function(e){ preview.src = e.target.result; }
            reader.readAsDataURL(file);
        } else { 
            preview.src = ''; 
        }
    });
}
</script>

{% endblock content %}