{% extends 'base.html' %}
{% block content %}
{% load custom_tags %}
{% load static %}
{% load time_blog %}
<h2 class="logo" style="display:none;">
    {% block header_title %}Willx{% endblock %}
</h2>

   

<!-- CSS spécifique à la page -->
<link rel="stylesheet" href="{% static 'css/home.css' %}">

{% include 'partials/action_buttons.html' with profile_mode=False %}

<div id="feed-container" class="photo-gallery" data-initial-offset="{{ photos|length }}">
    {% for photo in photos %}
        {% with photo.blog_set.all|first as related_blog %}
        <div class="photo-card-wrapper" data-photo-id="{{ photo.id }}">
            <div class="photo-card">
                <div class="photo-image-container">
                    <img src="{{ photo.image.url }}" alt="{{ photo.caption }}">
                    
                    
                    
                  
                        <a href="{% url 'user-profile' username=photo.uploader.username %}" class="user-info-overlay">
      
                        <div class="profile-photo small">
                            {% if photo.uploader.profile_photo %}
                                <img src="{{ photo.uploader.profile_photo.url }}" alt="{{ photo.uploader.username }}">
                            {% else %}
                                <img src="{% static 'icons/default_profile.png' %}" alt="Photo par défaut">
                            {% endif %}
                        </div>
                        <div class="details small">
    <p class="uploader-line">
        <!-- Lien vers le profil utilisateur -->
              {{ photo.uploader.username }}
        

        {% if photo.uploader.role == 'Creator' %}
            <svg class="creator-badge" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" role="img" aria-label="Creator badge">
                <defs>
                    <linearGradient id="gCreator" x1="0" x2="1" y1="0" y2="1">
                        <stop offset="0" stop-color="#3AB0FF"/>
                        <stop offset="1" stop-color="#1DA1F2"/>
                    </linearGradient>
                    <filter id="shadow" x="-50%" y="-50%" width="200%" height="200%">
                        <feDropShadow dx="0" dy="1.5" stdDeviation="2" flood-color="#0b76c9" flood-opacity="0.35"/>
                    </filter>
                </defs>
                <circle cx="12" cy="12" r="11.2" fill="url(#gCreator)" filter="url(#shadow)" />
                <path d="M8.6 12.2 L11 14.6 L15.6 9.8" fill="none" stroke="#fff" stroke-width="2.2"/>
            </svg>
        {% endif %}
    </p>
    <div class="date small">{{ photo.date_created|publications_time }}</div>
</div></a>



                </div>
                
                
                {% include "partials/publications_action.html" with photo=photo related_blog=photo.related_blog photo_likes=photo_likes %}
                
                
</div>
</div>
        {% endwith %}
    {% endfor %}
</div>

{% include 'partials/feed_loader.html' %}

{% if user.is_authenticated and not user.profile_photo %}
<div id="profileModal" class="modal">
  <div class="modal-content">
    <h2>Vous n'avez pas de photo de profil</h2>
    <form method="post" enctype="multipart/form-data" action="{% url 'update_profile_photo' %}">
      {% csrf_token %}
      <input type="file" name="profile_photo" id="profilePhotoInput" accept="image/*" required style="display:none">

      <div id="previewContainer" class="preview-container">
        <div class="preview-user-info">
          <div class="profile-photo preview-photo">
            <img id="currentPhoto" src="{% static 'icons/default_profile.png' %}" alt="Photo par défaut">
            <img id="previewImage" src="#" alt="Aperçu" class="hidden">
          </div>
        </div>
      </div>

      <div class="modal-actions">
        <button type="button" id="importBtn" class="btn">Importer</button>
        <button type="submit" class="btn primary">Enregistrer</button>
      </div>
    </form>
  </div>
</div>
{% endif %}




<!-- JS spécifique à la page -->
<script src="{% static 'js/home.js' %}" defer></script>

{% endblock content %}
