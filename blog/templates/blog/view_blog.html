{% extends 'base.html' %}
{% block content %}
<div class="login-card" role="main">
    <h1>{{ blog.title }}</h1>
    <p class="lead">Écrit par : {{ blog.author.username }}</p>

    {% if blog.photo %}
    <div class="blog-photo" data-photo-id="{{ blog.photo.id }}">
        <img src="{{ blog.photo.image.url }}" alt="Photo associée" />

        <!-- Likes -->
        <div class="likes" style="margin-top:8px; display: flex; justify-content: center; align-items: center; gap: 8px;">
    {% if user.is_authenticated %}
        <button class="like-btn {% if user_liked %}liked{% endif %}">
            {% if user_liked %}
                <!-- Cœur rempli SVG -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="red" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                             4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 
                             3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 
                             11.54L12 21.35z"/>
                </svg>
            {% else %}
                <!-- Cœur vide SVG -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                             4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 
                             3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 
                             11.54L12 21.35z"/>
                </svg>
            {% endif %}
        </button>
        <span class="likes-count">{{ likes_count }}</span>
    {% endif %}
</div>
    </div>
    
    {% endif %}

    <div class="blog-content">
        <p>{{ blog.content|linebreaks }}</p>
    </div>

    <div style="text-align:center; margin-top: 20px;">
        <a href="{% url 'home' %}" class="btn-deconnexion">Retour à l'accueil</a>
    </div>
</div>

<style>
.login-card {
    max-width: 600px;
    margin: 20px auto;
    background: var(--card, #fff);
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 6px 20px rgba(16,24,40,0.08);
    text-align: center;
}

.blog-photo img {
    max-width: 100%;
    border-radius: 10px;
    margin: 12px 0;
}

.blog-content {
    margin-top: 16px;
    font-size: 1rem;
    line-height: 1.5;
    text-align: left;
}

.btn-deconnexion {
    display: inline-block;
    padding: 10px 16px;
    border-radius: 12px;
    border: 1px solid #f87171;
    background: #fee2e2;
    color: #b91c1c;
    font-weight: 500;
    text-decoration: none;
    transition: 0.2s;
}

.btn-deconnexion:hover {
    background: #fca5a5;
    color: #fff;
}
.like-btn {
    border: none;
    background: none;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 0;
    transition: transform 0.12s ease;
}

.like-btn svg {
    width: 24px;       /* taille du cœur */
    height: 24px;
    transition: transform 0.12s ease, fill 0.2s ease, stroke 0.2s ease;
}

.like-btn.liked svg {
    fill: red;         /* cœur rempli */
    stroke: red;
}

.like-btn:hover svg {
    transform: scale(1.2);
}

.likes-count {
    margin-left: 8px;
    font-weight: 500;
    vertical-align: middle;
}

</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const heartFilled = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="red" viewBox="0 0 24 24">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                     4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 
                     3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 
                     11.54L12 21.35z"/>
        </svg>
    `;
    const heartEmpty = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                     4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 
                     3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 
                     11.54L12 21.35z"/>
        </svg>
    `;

    document.querySelectorAll('.like-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const card = btn.closest('.blog-photo');
            const photoId = card.dataset.photoId;

            fetch(`/photo/${photoId}/like/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                },
            })
            .then(res => res.json())
            .then(data => {
                btn.innerHTML = data.liked ? heartFilled : heartEmpty;
                card.querySelector('.likes-count').textContent = data.likes_count;
                btn.classList.toggle('liked', data.liked);
            });
        });
    });
});
</script>
{% endblock content %}