{% extends 'base.html' %}
{% block content %}


    
<div style="text-align:center; margin-top: 20px;">
    <a href="{% url 'home' %}" class="btn-deconnexion">Accueil</a>
    
    {% if user == blog.author %}
        <!-- Bouton modifier/supprimer visible seulement par l’auteur -->
        <a href="{% url 'edit_blog' blog.id %}" class="btn-edit">Editer</a>
    {% endif %}
</div>



    
    <style>
        body{
    
    padding: 0rem;
   
  }
    </style>
<div class="login-card" role="main">
    <h1>{{ blog.title }}</h1>
    <p class="lead">Écrit par : {{ blog.author.username }}</p>

    {% if blog.photo %}
    <div class="blog-photo" data-photo-id="{{ blog.photo.id }}">
        <img src="{{ blog.photo.image.url }}" alt="Photo associée" />

        <!-- Likes -->
        <div class="likes" style="margin-top:8px; display: flex; justify-content: center; align-items: center; gap: 8px;">
    {% if user.is_authenticated %}
        <button class="like-btn {% if user_liked %}liked{% endif %}">
            {% if user_liked %}
                <!-- Cœur rempli SVG -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="red" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                             4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 
                             3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 
                             11.54L12 21.35z"/>
                </svg>
            {% else %}
                <!-- Cœur vide SVG -->
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
                    <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                             4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 
                             3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 
                             11.54L12 21.35z"/>
                </svg>
            {% endif %}
        </button>
        <span class="likes-count">{{ likes_count }}</span>
    {% endif %}
</div>
    </div>
    
    {% endif %}

    <div class="blog-content">
        <p>{{ blog.content|linebreaks }}</p>
    </div>

    
</div>

<style>

</style>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const heartFilled = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="red" viewBox="0 0 24 24">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                     4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 
                     3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 
                     11.54L12 21.35z"/>
        </svg>
    `;
    const heartEmpty = `
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="white" stroke-width="2" viewBox="0 0 24 24">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 
                     4.42 3 7.5 3c1.74 0 3.41 0.81 4.5 2.09C13.09 3.81 14.76 
                     3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 
                     11.54L12 21.35z"/>
        </svg>
    `;

    document.querySelectorAll('.like-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
            e.preventDefault();
            const card = btn.closest('.blog-photo');
            const photoId = card.dataset.photoId;

            fetch(`/photo/${photoId}/like/`, {
                method: "POST",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                },
            })
            .then(res => res.json())
            .then(data => {
                btn.innerHTML = data.liked ? heartFilled : heartEmpty;
                card.querySelector('.likes-count').textContent = data.likes_count;
                btn.classList.toggle('liked', data.liked);
            });
        });
    });
});
</script>
{% endblock content %}
